---
title: 'Kubernetes Deployment'
description: 'Configuration reference for Zephyr Kubernetes edge worker deployment'
head:
  - - meta
    - property: og:description
      content: Configuration reference for Zephyr Kubernetes edge worker deployment
---

import { Badge } from '@rspress/core/theme';

# Kubernetes Deployment

<Badge text="Enterprise" type="warning" />

Zephyr's Kubernetes deployment option allows you to run the Zephyr edge worker on your own Kubernetes infrastructure. This deployment model provides maximum control over your infrastructure while leveraging Zephyr's deployment and versioning capabilities.

:::warning Enterprise Only

Kubernetes deployment is available exclusively for **Enterprise customers**. If you're interested in deploying Zephyr on your own Kubernetes infrastructure, please [contact our sales team](https://zephyr-cloud.io/contact) to discuss your requirements.

:::

## Overview

The Kubernetes edge worker (`ze-k8s-worker`) is a containerized service that handles asset uploads and serves your deployed applications. It integrates with:

- **S3-compatible storage** (AWS S3, MinIO, Ceph, etc.) for asset storage
- **Redis-compatible KV store** for environment configuration and snapshots

## Environment Variables

All environment variables are prefixed with `ZE_WORKER_`. Configuration can be provided via:

1. **Environment variables** (standard approach)
2. **JSON config file** (set `ZE_WORKER_CONFIG_JSON` to the file path; values in the JSON file take precedence over environment variables)

### Required Environment Variables

| Variable                         | Description                         | Example Value                                     |
| -------------------------------- | ----------------------------------- | ------------------------------------------------- |
| `ZE_WORKER_JWT_SECRET`           | Secret key for JWT token validation | `your-secret-key-here`                            |
| `ZE_WORKER_S3_ENDPOINT`          | S3-compatible storage endpoint URL  | `https://s3.amazonaws.com` or `http://minio:9000` |
| `ZE_WORKER_S3_ACCESS_KEY_ID`     | S3 access key ID                    | `AKIAIOSFODNN7EXAMPLE`                            |
| `ZE_WORKER_S3_SECRET_ACCESS_KEY` | S3 secret access key                | `wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY`        |
| `ZE_WORKER_S3_BUCKET`            | S3 bucket name for storing assets   | `zephyr-assets`                                   |
| `ZE_WORKER_REDIS_HOST`           | Redis-compatible KV store hostname  | `localhost` or `redis.default.svc.cluster.local`  |

### Optional Environment Variables

#### Server Configuration

| Variable              | Description                    | Default | Example Values                             |
| --------------------- | ------------------------------ | ------- | ------------------------------------------ |
| `ZE_WORKER_PORT`      | HTTP server port               | `8080`  | `3000`                                     |
| `ZE_WORKER_LOG_LEVEL` | Logging level                  | `info`  | `debug`, `trace`, `warn`, `error`, `fatal` |
| `ZE_WORKER_DELIMITER` | Delimiter for hostname parsing | `-`     | `.` or `_`                                 |

#### S3 Configuration

| Variable                        | Description                                   | Default     | Example     |
| ------------------------------- | --------------------------------------------- | ----------- | ----------- |
| `ZE_WORKER_S3_REGION`           | S3 region                                     | `us-east-1` | `eu-west-1` |
| `ZE_WORKER_S3_FORCE_PATH_STYLE` | Use path-style URLs (required for MinIO/Ceph) | `true`      | `false`     |

#### Redis/KV Configuration

| Variable                           | Description                          | Default                      | Example               |
| ---------------------------------- | ------------------------------------ | ---------------------------- | --------------------- |
| `ZE_WORKER_REDIS_PORT`             | Redis port                           | `6379`                       | `6380`                |
| `ZE_WORKER_REDIS_PASSWORD`         | Redis password (if required)         | _(empty)_                    | `your-redis-password` |
| `ZE_WORKER_REDIS_TLS`              | Enable TLS for Redis connection      | `false`                      | `true`                |
| `ZE_WORKER_REDIS_DB`               | Redis database number                | `0`                          | `1`, `2`, etc.        |
| `ZE_WORKER_REDIS_PREFIX_ENVS`      | Key prefix for environment variables | `{ze-k8s-worker}:envs:`      | `{myapp}:envs:`       |
| `ZE_WORKER_REDIS_PREFIX_SNAPSHOTS` | Key prefix for snapshots             | `{ze-k8s-worker}:snapshots:` | `{myapp}:snapshots:`  |

:::info Redis Key Prefixes

The curly braces `{}` in the default prefixes enable Redis Cluster hash tags. This ensures all keys with the same hash tag are stored on the same cluster node, enabling multi-key operations, transactions, and better performance. For standalone Redis instances, the braces have no special meaning but don't cause issues.

:::

## Using JSON Config File

Instead of setting individual environment variables, you can create a JSON file with all configuration:

```json
{
  "ZE_WORKER_PORT": "8080",
  "ZE_WORKER_JWT_SECRET": "your-secret-key",
  "ZE_WORKER_LOG_LEVEL": "info",
  "ZE_WORKER_DELIMITER": "-",
  "ZE_WORKER_S3_ENDPOINT": "https://s3.amazonaws.com",
  "ZE_WORKER_S3_REGION": "us-east-1",
  "ZE_WORKER_S3_ACCESS_KEY_ID": "AKIAIOSFODNN7EXAMPLE",
  "ZE_WORKER_S3_SECRET_ACCESS_KEY": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",
  "ZE_WORKER_S3_BUCKET": "zephyr-assets",
  "ZE_WORKER_S3_FORCE_PATH_STYLE": "true",
  "ZE_WORKER_REDIS_HOST": "redis.default.svc.cluster.local",
  "ZE_WORKER_REDIS_PORT": "6379",
  "ZE_WORKER_REDIS_PASSWORD": "optional-password",
  "ZE_WORKER_REDIS_TLS": "false",
  "ZE_WORKER_REDIS_DB": "0",
  "ZE_WORKER_REDIS_PREFIX_ENVS": "{ze-k8s-worker}:envs:",
  "ZE_WORKER_REDIS_PREFIX_SNAPSHOTS": "{ze-k8s-worker}:snapshots:"
}
```

Then set the path to this file:

```bash
export ZE_WORKER_CONFIG_JSON=/path/to/config.json
```

### Kubernetes Secret Example

Mount a Secret as a JSON file for secure configuration:

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: ze-worker-config
type: Opaque
stringData:
  config.json: |
    {
      "ZE_WORKER_JWT_SECRET": "...",
      "ZE_WORKER_S3_ACCESS_KEY_ID": "...",
      "ZE_WORKER_S3_SECRET_ACCESS_KEY": "...",
      ...
    }
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ze-k8s-worker
spec:
  template:
    spec:
      containers:
        - name: worker
          image: ze-k8s-worker:latest
          env:
            - name: ZE_WORKER_CONFIG_JSON
              value: /etc/ze-worker/config.json
          volumeMounts:
            - name: config
              mountPath: /etc/ze-worker
              readOnly: true
      volumes:
        - name: config
          secret:
            secretName: ze-worker-config
```

## Health Check Endpoints

The worker exposes the following health check endpoints for Kubernetes probes:

| Endpoint       | Type            | Description                                                              |
| -------------- | --------------- | ------------------------------------------------------------------------ |
| `GET /healthz` | Liveness probe  | Always returns `200` if the process is running                           |
| `GET /readyz`  | Readiness probe | Checks S3 and Redis connectivity; returns `200` if healthy, `503` if not |

### Example Probe Configuration

```yaml
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /readyz
    port: 8080
  initialDelaySeconds: 5
  periodSeconds: 10
```

## Example Configurations

### Development (MinIO + Redis)

```bash
# Server
export ZE_WORKER_PORT=8080
export ZE_WORKER_JWT_SECRET=dev-secret-key
export ZE_WORKER_LOG_LEVEL=debug
export ZE_WORKER_DELIMITER=-

# S3 (MinIO)
export ZE_WORKER_S3_ENDPOINT=http://localhost:9000
export ZE_WORKER_S3_REGION=us-east-1
export ZE_WORKER_S3_ACCESS_KEY_ID=minioadmin
export ZE_WORKER_S3_SECRET_ACCESS_KEY=minioadmin
export ZE_WORKER_S3_BUCKET=zephyr-dev
export ZE_WORKER_S3_FORCE_PATH_STYLE=true

# Redis
export ZE_WORKER_REDIS_HOST=localhost
export ZE_WORKER_REDIS_PORT=6379
export ZE_WORKER_REDIS_TLS=false
export ZE_WORKER_REDIS_DB=0
```

### Production (AWS S3 + Redis Cluster)

```bash
# Server
export ZE_WORKER_PORT=8080
export ZE_WORKER_JWT_SECRET=your-production-secret
export ZE_WORKER_LOG_LEVEL=info
export ZE_WORKER_DELIMITER=-

# S3 (AWS)
export ZE_WORKER_S3_ENDPOINT=https://s3.us-west-2.amazonaws.com
export ZE_WORKER_S3_REGION=us-west-2
export ZE_WORKER_S3_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE
export ZE_WORKER_S3_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
export ZE_WORKER_S3_BUCKET=zephyr-production
export ZE_WORKER_S3_FORCE_PATH_STYLE=false

# Redis Cluster with TLS
export ZE_WORKER_REDIS_HOST=redis-cluster.example.com
export ZE_WORKER_REDIS_PORT=6380
export ZE_WORKER_REDIS_PASSWORD=your-redis-password
export ZE_WORKER_REDIS_TLS=true
export ZE_WORKER_REDIS_DB=0
export ZE_WORKER_REDIS_PREFIX_ENVS={zephyr-prod}:envs:
export ZE_WORKER_REDIS_PREFIX_SNAPSHOTS={zephyr-prod}:snapshots:
```

## Troubleshooting

### Common Issues

#### Worker fails to start

1. Verify all required environment variables are set
2. Check that S3 endpoint is reachable from within the cluster
3. Ensure Redis host is resolvable and accessible

#### Readiness probe failing

1. Check S3 bucket exists and credentials have read/write access
2. Verify Redis connection (host, port, password, TLS settings)
3. Review worker logs for specific error messages

#### Assets not serving correctly

1. Confirm `ZE_WORKER_DELIMITER` matches your DNS configuration
2. Verify S3 bucket policy allows the worker to read objects
3. Check that the Ingress or load balancer is routing traffic correctly

### Getting Help

If you encounter issues with your Kubernetes deployment, reach out to your Zephyr account representative or contact us on [Discord](https://discord.gg/zephyrcloud).
